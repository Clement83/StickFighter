
const byte arene[] PROGMEM = {88,48,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x62,0x7,0xFF,0xFF,0xFC,0x3,0xFF,0xFF,0xFE,0xC,0xE0,0x56,0x4,0x4,0x4,0x4,0x2,0x2,0x2,0x2,0xA,0x20,0x62,0x4,0x4,0x4,0x4,0x2,0x2,0x2,0x2,0xC,0xE0,0x42,0x4,0x4,0x4,0x4,0x2,0x2,0x2,0x2,0x8,0x80,0x47,0x7,0xFF,0xFF,0xFC,0x3,0xFF,0xFF,0xFE,0x8,0xE0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x31,0x8C,0x0,0x0,0x0,0x0,0x0,0x0,0x3,0x18,0xC0,0x4A,0x52,0x0,0x0,0x0,0x0,0x0,0x0,0x4,0xA5,0x20,0x4A,0x52,0x0,0x0,0x0,0x0,0x0,0x0,0x4,0xA5,0x20,0x31,0x8C,0x0,0x0,0x0,0x0,0x0,0x0,0x3,0x18,0xC0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xF0,0x80,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x10,0x80,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x10,0x80,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x10,0xD5,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x55,0x50,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xF0,};

const byte cptBold1[] PROGMEM = {8,12,0x18,0x28,0x48,0xA8,0xE8,0xE8,0x28,0x28,0xEC,0x84,0xFC,0xFC,};
const byte cptBold2[] PROGMEM = {8,12,0xFC,0x84,0xF4,0xF4,0xF4,0x84,0xBC,0xBC,0xBC,0x84,0xFC,0xFC,};
const byte cptBold3[] PROGMEM = {8,12,0xFC,0x84,0xF4,0xF4,0xF4,0x84,0xF4,0xF4,0xF4,0x84,0xFC,0xFC,};
const byte fight[] PROGMEM = {32,12,0xFD,0xF7,0xEF,0xDF,0x85,0x14,0x2B,0x51,0xBD,0xB5,0xEB,0x5B,0xBD,0xB5,0xEB,0x5B,0xBC,0xA5,0xB,0x4A,0x84,0xA5,0xE8,0x4A,0xBC,0xA5,0x2B,0x4A,0xBC,0xA5,0xAB,0x4A,0xA0,0xA5,0xAB,0x4A,0xA1,0x14,0x2B,0x4A,0xE1,0xF7,0xEF,0xCE,0xE1,0xF7,0xEF,0xCE,};

const byte timeUp[] PROGMEM = {48,12,0xFB,0xEF,0xDF,0x80,0x7E,0xFC,0x8A,0x28,0x50,0x80,0x5A,0x84,0xDB,0x68,0x57,0x80,0x5A,0xB4,0xDB,0x68,0x57,0x80,0x5A,0xB4,0x51,0x4B,0x57,0x80,0x5A,0x84,0x51,0x4B,0x50,0x80,0x5A,0xBC,0x51,0x4B,0x57,0x80,0x5A,0xBC,0x51,0x4B,0x57,0x80,0x5A,0xA0,0x51,0x4B,0x57,0x80,0x5A,0xA0,0x52,0x2B,0x50,0x80,0x42,0xA0,0x73,0xEF,0xDF,0x80,0x7E,0xE0,0x73,0xEF,0xDF,0x80,0x7E,0xE0,};
const byte p1ko[] PROGMEM = {40,12,0xF0,0x30,0x7,0xEF,0xC0,0x88,0x50,0x5,0xA8,0x40,0xB4,0x90,0x5,0xAB,0x40,0xB5,0x50,0x5,0xAB,0x40,0xB5,0xD0,0x5,0xAB,0x40,0x8D,0xD0,0x4,0x6B,0x40,0xB8,0x50,0x5,0xAB,0x40,0xB0,0x50,0x5,0xAB,0x40,0xA1,0xD8,0x5,0xAB,0x40,0xA1,0x8,0x5,0xA8,0x40,0xE1,0xF8,0x7,0xEF,0xC0,0xE1,0xF8,0x7,0xEF,0xC0,};
const byte p2ko[] PROGMEM = {40,12,0xF1,0xF8,0x7,0xEF,0xC0,0x89,0x8,0x5,0xA8,0x40,0xB5,0xE8,0x5,0xAB,0x40,0xB5,0xE8,0x5,0xAB,0x40,0xB5,0xE8,0x5,0xAB,0x40,0x8D,0x8,0x4,0x6B,0x40,0xB9,0x78,0x5,0xAB,0x40,0xB1,0x78,0x5,0xAB,0x40,0xA1,0x78,0x5,0xAB,0x40,0xA1,0x8,0x5,0xA8,0x40,0xE1,0xF8,0x7,0xEF,0xC0,0xE1,0xF8,0x7,0xEF,0xC0,};


const byte cpt0[] PROGMEM = {8,5,0xE0,0xA0,0xA0,0xA0,0xE0,};
const byte cpt1[] PROGMEM = {8,5,0x40,0xC0,0x40,0x40,0xE0,};
const byte cpt2[] PROGMEM = {8,5,0xE0,0x20,0xE0,0x80,0xE0,};
const byte cpt3[] PROGMEM = {8,5,0xE0,0x20,0xE0,0x20,0xE0,};
const byte cpt4[] PROGMEM = {8,5,0xA0,0xA0,0xE0,0x20,0x20,};
const byte cpt5[] PROGMEM = {8,5,0xE0,0x80,0xE0,0x20,0xE0,};
const byte cpt6[] PROGMEM = {8,5,0xE0,0x80,0xE0,0xA0,0xE0,};
const byte cpt7[] PROGMEM = {8,5,0xE0,0x20,0x20,0x20,0x20,};
const byte cpt8[] PROGMEM = {8,5,0xE0,0xA0,0xE0,0xA0,0xE0,};
const byte cpt9[] PROGMEM = {8,5,0xE0,0xA0,0xE0,0x20,0x20,};


byte const * tabCpt[4]  = {fight,cptBold1,cptBold2,cptBold3}; 
byte const * tabCptGame[100][2]   = {
                                  {cpt0,cpt0},{cpt0,cpt1},{cpt0,cpt2},{cpt0,cpt3},{cpt0,cpt4},{cpt0,cpt5},{cpt0,cpt6},{cpt0,cpt7},{cpt0,cpt8},{cpt0,cpt9},
                                  {cpt1,cpt0},{cpt1,cpt1},{cpt1,cpt2},{cpt1,cpt3},{cpt1,cpt4},{cpt1,cpt5},{cpt1,cpt6},{cpt1,cpt7},{cpt1,cpt8},{cpt1,cpt9},
                                  {cpt2,cpt0},{cpt2,cpt1},{cpt2,cpt2},{cpt2,cpt3},{cpt2,cpt4},{cpt2,cpt5},{cpt2,cpt6},{cpt2,cpt7},{cpt2,cpt8},{cpt2,cpt9},
                                  {cpt3,cpt0},{cpt3,cpt1},{cpt3,cpt2},{cpt3,cpt3},{cpt3,cpt4},{cpt3,cpt5},{cpt3,cpt6},{cpt3,cpt7},{cpt3,cpt8},{cpt3,cpt9},
                                  {cpt4,cpt0},{cpt4,cpt1},{cpt4,cpt2},{cpt4,cpt3},{cpt4,cpt4},{cpt4,cpt5},{cpt4,cpt6},{cpt4,cpt7},{cpt4,cpt8},{cpt4,cpt9},
                                  {cpt5,cpt0},{cpt5,cpt1},{cpt5,cpt2},{cpt5,cpt3},{cpt5,cpt4},{cpt5,cpt5},{cpt5,cpt6},{cpt5,cpt7},{cpt5,cpt8},{cpt5,cpt9},
                                  {cpt6,cpt0},{cpt6,cpt1},{cpt6,cpt2},{cpt6,cpt3},{cpt6,cpt4},{cpt6,cpt5},{cpt6,cpt6},{cpt6,cpt7},{cpt6,cpt8},{cpt6,cpt9},
                                  {cpt7,cpt0},{cpt7,cpt1},{cpt7,cpt2},{cpt7,cpt3},{cpt7,cpt4},{cpt7,cpt5},{cpt7,cpt6},{cpt7,cpt7},{cpt7,cpt8},{cpt7,cpt9},
                                  {cpt8,cpt0},{cpt8,cpt1},{cpt8,cpt2},{cpt8,cpt3},{cpt8,cpt4},{cpt8,cpt5},{cpt8,cpt6},{cpt8,cpt7},{cpt8,cpt8},{cpt8,cpt9},
                                  {cpt9,cpt0},{cpt9,cpt1},{cpt9,cpt2},{cpt9,cpt3},{cpt9,cpt4},{cpt9,cpt5},{cpt9,cpt6},{cpt9,cpt7},{cpt9,cpt8},{cpt9,cpt9}
                               }; 




void initArena()
{
 cptCombat = CPT_COMBAT_INIT;
 cptTechArena = 80;
 stateFight = 0;
 xoffsetCptGras = 0;
 yoffsetTimeUp = 0;
}

void updateArena()
{
  if(cptTechArena>0) cptTechArena--;
  if(stateFight == 0)
  {
    if(cptTechArena == 19)
    {
      xoffsetCptGras = 13;
    }
    else if(cptTechArena == 0)
    {
      stateFight = 1;
    }
  }
  if(stateFight == 1 && cptCombat == 0)
  {
    stateFight = 3;
    cptTechArena = 60;
  }
  
 
  if((Player1.life == 0 ||Player2.life == 0) && stateFight != 2)
  {
    stateFight = 2;
    cptTechArena = 60;
  }
  
  if(stateFight == 1)
  {  
    if(gb.frameCount%20 == 0) cptCombat--;
  }
  
  if(stateFight == 3 || stateFight == 2)
  {
    if(cptTechArena >= 30 )
    {
      yoffsetTimeUp = cptTechArena-30;
    }
    if(cptTechArena ==0 )
    {
      stateFight = 4;
    }
  }
}


void drawArena()
{
  //return;
  gb.display.drawBitmap(0,0,arene);
  switch(stateFight)
  {
    case 0 :
       //3, 2, 1 Fight! 

       gb.display.drawBitmap(39-xoffsetCptGras,18,tabCpt[((uint8_t)cptTechArena/20)]);

    break;
    case 1 :
       //Fight 

       //displayInt(cptCombat,38,1,2);
    break;
    case 2 :
       //Figther KO 
       if(Player1.life != Player2.life)
       {
         gb.display.drawBitmap(29,18 + yoffsetTimeUp,((Player1.life == 0)? p1ko : p2ko) );
       }
    break;
    case 3 :
       //Time UP 
       gb.display.drawBitmap(21,18 + yoffsetTimeUp,timeUp);
    break;
  }
  
   gb.display.drawBitmap(39,1,tabCptGame[cptCombat][0]);
   gb.display.drawBitmap(42,1,tabCptGame[cptCombat][1]);
}

void restartCombat()
{
  initPlayer(false);
  initArena();
}


